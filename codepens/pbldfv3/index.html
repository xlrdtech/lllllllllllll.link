<!-- 1. LOAD DEPENDENCIES -->
<script src="https://cdn.tailwindcss.com"></script>
<script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
<script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

<!-- LOGIC LIBRARIES -->
<script src="https://cdn.jsdelivr.net/npm/jspdf@latest/dist/jspdf.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
<script src="https://unpkg.com/dropbox/dist/Dropbox-sdk.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/tesseract.js@4/dist/tesseract.min.js"></script>
<!-- PDF.js for parsing PDF content -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js"></script>
<!-- Mammoth.js for parsing Word documents -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.6.0/mammoth.browser.min.js"></script>

<!-- 2. STYLES -->
<style>
    /* FULL SCREEN BACKGROUND */
    #project-build-wrapper {
        background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 50%, #dcfce7 100%);
        background-size: 200% 200%;
        animation: gradientBG 15s ease infinite;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        min-height: 100vh; 
        width: 100%;
        display: flex;
        justify-content: center; 
        align-items: flex-start;
        padding: 20px 10px; /* Reduced padding for mobile */
        box-sizing: border-box;
    }

    /* Responsive Padding for Desktop */
    @media (min-width: 768px) {
        #project-build-wrapper {
            padding: 40px 20px;
        }
    }

    @keyframes gradientBG {
        0% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
        100% { background-position: 0% 50%; }
    }

    #project-build-root { width: 100%; max-width: 1400px; margin: 0 auto; }

    /* GLASS PANELS */
    .glass-panel {
        background: rgba(255, 255, 255, 0.85); 
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.9);
        box-shadow: 0 15px 30px -12px rgba(0, 0, 0, 0.15); /* Slightly smaller shadow on mobile */
        border-radius: 24px; /* Slightly smaller radius on mobile */
        width: 100%; 
        overflow: hidden;
    }

    @media (min-width: 768px) {
        .glass-panel {
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.15);
            border-radius: 32px;
        }
    }

    .glass-panel-hero {
        background: rgba(255, 255, 255, 0.9); 
        backdrop-filter: blur(24px);
        -webkit-backdrop-filter: blur(24px);
        border: 1px solid rgba(255, 255, 255, 0.95);
        box-shadow: 0 20px 40px -15px rgba(0, 0, 0, 0.2);
        border-radius: 24px;
        margin: 20px auto; 
        overflow: hidden;
        max-width: 600px; 
    }

    @media (min-width: 768px) {
        .glass-panel-hero {
            border-radius: 32px;
            margin: 40px auto;
            box-shadow: 0 30px 60px -15px rgba(0, 0, 0, 0.2);
        }
    }

    /* GREEN HEADER GLASS */
    .header-green-glass {
        background: linear-gradient(135deg, rgba(22, 163, 74, 0.95) 0%, rgba(21, 128, 61, 0.98) 100%); 
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        border-bottom: 1px solid rgba(255,255,255,0.2);
        color: white;
        padding: 1.25rem; /* Smaller padding on mobile */
        box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
    }

    @media (min-width: 768px) {
        .header-green-glass {
            padding: 2rem;
        }
    }

    /* SCROLLABLE LEGAL BOX */
    .legal-scroll-box {
        max-height: 150px; /* Smaller on mobile */
        overflow-y: auto;
        background: #f8fafc;
        border: 1px solid #cbd5e1;
        padding: 12px; /* Smaller padding */
        border-radius: 8px;
        font-size: 0.75rem; /* Smaller text */
        color: #334155;
        line-height: 1.5;
        margin-bottom: 12px;
        white-space: pre-wrap; 
        box-shadow: inset 0 2px 4px rgba(0,0,0,0.05);
    }

    @media (min-width: 768px) {
        .legal-scroll-box {
            max-height: 200px;
            padding: 20px;
            border-radius: 12px;
            font-size: 0.9rem;
            line-height: 1.6;
            margin-bottom: 16px;
        }
    }

    /* BUTTONS */
    .btn-liquid {
        background: linear-gradient(180deg, #16a34a 0%, #15803d 100%);
        box-shadow: 0 4px 15px rgba(22, 163, 74, 0.3), inset 0 1px 0 rgba(255,255,255,0.4);
        border: 1px solid #14532d;
        transition: all 0.3s ease;
        color: white;
        text-shadow: 0 1px 2px rgba(0,0,0,0.2);
        font-size: 0.95rem; /* Smaller text on mobile */
        letter-spacing: 0.025em;
        padding: 0.75rem 1.5rem; /* Smaller padding */
    }

    @media (min-width: 768px) {
        .btn-liquid {
            box-shadow: 0 6px 20px rgba(22, 163, 74, 0.3), inset 0 1px 0 rgba(255,255,255,0.4);
            font-size: 1.1rem;
            padding: 1rem 2rem; /* Larger padding */
        }
        .btn-liquid:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(22, 163, 74, 0.5), inset 0 1px 0 rgba(255,255,255,0.4);
        }
    }

    .btn-liquid:disabled {
        background: #94a3b8;
        border-color: #64748b;
        cursor: not-allowed;
        transform: none;
        box-shadow: none;
    }

    .loading-text { text-align: center; color: #374151; font-weight: bold; width: 100%; font-size: 1rem; }
    @media (min-width: 768px) { .loading-text { font-size: 1.2rem; } }

    .fade-in { animation: fadeIn 0.6s cubic-bezier(0.16, 1, 0.3, 1); }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

    /* PRINT STYLES */
    @media print {
        #wpadminbar, header, footer, .sidebar, .widget-area, .site-footer, .site-header, nav { display: none !important; }
        body { background: white !important; margin: 0 !important; padding: 0 !important; visibility: hidden; }
        #project-build-wrapper { 
            background: white !important; padding: 0 !important; position: absolute; left: 0; top: 0; width: 100%; height: auto;
            visibility: visible; display: block; 
        }
        #project-build-wrapper * { visibility: visible; }
        .glass-panel, .glass-panel-hero {
            background: white !important; backdrop-filter: none !important; box-shadow: none !important; border: none !important; border-radius: 0 !important; color: black !important;
            max-width: 100% !important; padding: 0 !important;
        }
        .header-green-glass {
            background: white !important; color: black !important; padding: 0 !important; border-bottom: 4px solid #15803d !important; box-shadow: none !important;
        }
        .no-print, .legal-scroll-box, #submit-actions { display: none !important; }
        .print-only-legal { display: block !important; font-size: 10px; text-align: justify; margin-bottom: 10px; }
        .print-logo { height: 80px !important; width: auto !important; display: block !important; }
        /* Hide non-print logo */
        .screen-logo { display: none !important; }
        .text-white { color: black !important; }
        
        input, select, textarea { border: none !important; border-bottom: 1px solid #000 !important; padding: 0 !important; font-weight: bold; appearance: none; background: white !important; }
        ::placeholder { color: transparent; }
    }
    .print-only-legal { display: none; }
</style>

<!-- 3. CONTAINER -->
<div id="project-build-wrapper">
    <div id="project-build-root">
        <div class="loading-text">Loading Application...</div>
    </div>
</div>

<!-- 4. REACT LOGIC -->
<script type="text/babel">
    const { useState, useEffect } = React;

    // --- CONFIGURATION ---
    const CONFIG = {
      emailjs: {
        publicKey: 'aorg2___J2NM2WBFJ',
        serviceId: 'email@xlrd.org',
        templateId: 'template_efuux1q'
      },
      dropbox: {
        // ⚠️ REFRESH THIS TOKEN OFTEN or setup a backend generator
        accessToken: 'sl.u.AGLVTTMNkmU3FGDBFQySRC3VrWvKr8a6P9w299_mSChZt55pBA9awpb9A0oeTVDr3TrJLE8tPC0zvLq1H9cEZb81dHLpWIYHfMDV4zEkmf1yC8mtcyhzh2-zgq5JXdI-nNdTFoGGq81gWHEoQeHuANlHfznLy0zez7UBaPk9bxEl2wMpLGaAJbIQ63EJvXXOFbIK2ooEGizh4VlAPr4Lpf3gLQnSrviXHc1ejbkK6UB3xqJIv6TCMmcbgGORa74C7zKWfkdcSG6Guh1vfDM8l_F9n4wV_toko3yMLY2U3U9MIDQFzbpWdaIhBcqGY5ceir-CZuOav1EtovGX9lRdZr99Nk1AxwWkH4y-S07CRCcoE4FvCYUtNAjOBtaP_9Ek1A0p_uPseBJAPIgytxKLqZIKtU6YY6-ud68LITocNs1qR-6cQP-VDRmaVT58DArNoiJ6G2k2qHXApoTGS3ft155SPHMO0vqJjwrlFDsFVgegK-FBqNTkNi7x2qO91Uca49ynb-0r9DdHm7Ue7dROBefRXPA6QII0W4RBjUBfKgMWBJpNAahoO7DGQymcIXG6gVhHSGmHCyzk3vgxzFyV5U-rw3zIS-av-USncN1KF9Hbs2Y3gD0kWqxjQUpOmiOJNiIscsBV1TvA8IjXvUY6s5wQwynxoEQRV57fBmIsUY4thlW_hQwzYoBRCXr3M3sPEhRBNmXEqJ40ZiUSHuZ01t_aI-5kCHPi-OsqyQW7ubHAL8iQVfQaMSo_kP_q0DYWMme39JXnsOx72EczfwRDu0tHJQEk0g0GHX_KdAuF6NVLZ26xpW4a2i47PLNfMoZ5TFv4geVV00zFf_y-hy6x_douQFjlPBwSXJf6ykjzBewyOJ43B1oYwY04-ovvhUkPfaUztieE-JZmxAzKi5at987TCXqkfsA_BEXdQotGl6bOZ1lQUIaq1QXC8O-YNeSBRwM-1ofnRbTfWNnu5GkPVEapCVK10qPn0MKMvGKfM3F9cFfK-lGLqeXKICjcvQArTEXv_Crb2EZxbwh71e30orzhHjTeq17oBfdLzBquDuiAyb58x_RPlkklZsdwX_5u-e5ibiPql6ZpB4S27O5ch6aGGn5IY3dMZBL5QjaLROFCSpWJBj5uM8BDOvqWZTXnTiAAjL_bE_pVbtX3YmqNK8kbWHaU8R5tJxANaa0qISIoGMs3BnyBZslX-j6CXYkKZ4DDMdtCU3-jv2gr4j_bDkSuvGeRKJwTn-DtBLqBD6eR49F3i003lHOtLhh59i6vv_u17Sah2yMRySj5Vhnfu6PI-mdZkiLfbvtcv1AjnFNuNr-HTH_o1aTLQzU7MCfAFv9L50Cn52P4dKPzpn6cDhPowsy50e5o_sukf5INOh4CNiIJyppIcm0ORgkT8s-oKLVkUE68e8wPAlAOmPcUmZ2L' 
      }
    };

    // Initialize EmailJS
    try {
        emailjs.init(CONFIG.emailjs.publicKey);
    } catch (e) { console.error("EmailJS init failed", e); }


    // --- ICONS ---
    const Icon = ({ d, className = "w-6 h-6" }) => (
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d={d} /></svg>
    );
    const Icons = {
        HardHat: (p) => <Icon {...p} d="M2 12h20M12 2a10 10 0 0 0-10 10v1.5h20V12a10 10 0 0 0-10-10zm-5.5 10v-1.5h3V12" />,
        User: (p) => <Icon {...p} d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2M12 3a4 4 0 1 0 0 8 4 4 0 0 0 0-8z" />,
        Check: (p) => <Icon {...p} d="M22 11.08V12a10 10 0 1 1-5.93-9.14M22 4L12 14.01l-3-3" />,
        File: (p) => <Icon {...p} d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" />,
        Shield: (p) => <Icon {...p} d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z" />,
        Printer: (p) => <Icon {...p} d="M6 9V2h12v7M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2M6 14h12v8H6z" />,
        Mail: (p) => <Icon {...p} d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2zM22 6l-10 7L2 6" />,
        Camera: (p) => <Icon {...p} d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z M12 13a4 4 0 1 0 0 8 4 4 0 0 0 0-8z" />,
        Upload: (p) => <Icon {...p} d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M17 8l-5-5-5 5M12 3v12" />,
        Sparkles: (p) => <Icon {...p} d="M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2Z" />
    };

    // --- LEGAL TEXT ---
    const LegalText = {
        Workforce: `I, the undersigned (or legal guardian if under 18), give permission to participate in the Project BUILD’s Workforce Development Program. I understand that there are different aspects of this course, including but not limited to lessons through workbooks, computer programs, lectures, visual learning, and hands on projects where participants will build things on their own with instructor supervision. The Workforce Development Program’s duration is 6 to 9 months. When participants begin the Project BUILD’s Workforce Development Program, they will be issued steel toed work boots, tools, toolbox and tool belt which they keep once they have successfully completed the full course, along with their certificate of completion.`,
        Forklift: `I, the undersigned (or legal guardian if under 18), give permission to participate in the Project BUILD Forklift Certification Program.`,
        Liability: `Project BUILD Student Participation Waiver & Liability Release.
Acknowledgment of Risk: I understand that participation in Project BUILD’s Workforce Development Program may include activities that involve physical labor, the use of hand or power tools, exposure to outdoor elements, and travel to and from various work or training sites. I acknowledge that these activities may carry inherent risks, including the possibility of personal injury, property damage, or unforeseen incidents.
Voluntary Participation: I confirm that I am voluntarily participating in the program and its related activities. I understand that I am not required to perform any task that I do not feel comfortable with or capable of completing safely, and I agree to follow all safety protocols and staff instructions.
Waiver of Liability: In consideration of being permitted to participate in this program, I, on behalf of myself, my heirs, executors, administrators, and assigns, hereby waive, release, and discharge Project BUILD, its officers, directors, staff, volunteers, program partners, and any affiliated site hosting training or service activities, from any and all liability for injury, loss, or damage arising from or in connection with my participation in the program. This includes, but is not limited to, liability for negligence, personal injury, medical expenses, emotional distress, or property loss.
Medical Acknowledgment: I certify that I am in reasonably good health and able to participate in hands-on tasks and light to moderate physical activity. I authorize Project BUILD staff or instructors to seek appropriate emergency medical care and treatment on my behalf.`,
        ROI: `Release of Information: Client acknowledges use of and gives permission to this agency to use their personal information in the CRN (Community Resource Network)/ data base. No unaccompanied youth shall have an ROI unless they are 18 years of age or have consent of a parent/guardian. This Release of Information will be used for purposes of accessing services throughout available counties. Client further testifies that all information given on this Intake Form is true and complete to the best of their knowledge. I authorize that a copy of this original will serve as an original for the purposes stated above. Unless I make a formal request to a CRN Member Agency that I no longer want to participate in the CRN, this release will remain enforce for 2 years from today signed date.`,
        Media: `Please be advised that you may be photographed, videotaped, or interviewed throughout the course of the workforce program and/or at various program events. With your consent, the photograph, video and/or interview may be reproduced and released for use in the media, i.e., newspapers, brochures, videos, television, the internet, and social media platforms such as Facebook, LinkedIn, X (formerly known as Twitter) or Instagram.`
    };

    // --- HELPER COMPONENTS ---
    const SectionHeader = ({ title, icon: IconComp }) => (
        <div className="flex items-center gap-3 mb-6 mt-8 border-b border-slate-200 pb-2 md:mb-8 md:mt-10 md:pb-3">
            <div className="bg-green-100 p-2 rounded-full shadow-sm md:p-3">
                {IconComp && <IconComp className="w-6 h-6 text-green-700 md:w-8 md:h-8" />}
            </div>
            <h3 className="text-xl font-bold text-slate-800 uppercase tracking-wide md:text-2xl">{title}</h3>
        </div>
    );

    const InputGroup = ({ label, name, value, onChange, type = "text", required, options, placeholder, width = "full", id }) => (
        <div className={`mb-4 ${width === 'half' ? 'md:w-1/2' : 'w-full'} md:mb-6`}>
            <label className="block text-sm font-bold text-slate-700 mb-1 md:text-base md:mb-2">{label} {required && <span className="text-red-500">*</span>}</label>
            {options ? (
                <select id={id} name={name} value={value} onChange={onChange} className="w-full p-3 border border-slate-300 rounded-lg bg-white focus:ring-2 focus:ring-green-600 outline-none shadow-sm text-base md:p-4 md:text-lg md:rounded-xl">
                    <option value="">Select...</option>
                    {options.map(opt => <option key={opt} value={opt}>{opt}</option>)}
                </select>
            ) : (
                <input id={id} type={type} name={name} value={value} onChange={onChange} placeholder={placeholder} className="w-full p-3 border border-slate-300 rounded-lg bg-white focus:ring-2 focus:ring-green-600 outline-none shadow-sm text-base md:p-4 md:text-lg md:rounded-xl" required={required} />
            )}
        </div>
    );

    const LegalCheckbox = ({ label, name, checked, onChange, legalText }) => (
        <div className="mb-8 bg-white p-4 rounded-xl shadow-sm border border-slate-100 md:mb-10 md:p-6 md:rounded-2xl md:shadow-md">
            <h4 className="font-bold text-green-800 mb-2 text-md md:mb-3 md:text-lg">{label}</h4>
            <div className="legal-scroll-box no-print">{legalText}</div>
            <div className="print-only-legal">I have read and agree to the full text of the {label}.</div>
            <label className="flex items-center gap-3 p-3 bg-slate-50 border border-slate-200 rounded-lg cursor-pointer hover:bg-green-50 transition-all md:gap-4 md:p-4 md:rounded-xl">
                <input type="checkbox" name={name} checked={checked} onChange={(e) => onChange({ target: { name, checked: e.target.checked, type: 'checkbox' } })} className="w-5 h-5 text-green-600 rounded focus:ring-green-500 md:w-6 md:h-6" required />
                <span className="text-sm font-bold text-slate-800 md:text-base">I HAVE READ AND AGREE TO THESE TERMS</span>
            </label>
        </div>
    );

    // --- APP COMPONENT ---
    const App = () => {
        const [step, setStep] = useState(0);
        const [isUnder18, setIsUnder18] = useState(null);
        const [status, setStatus] = useState("");
        const [isSubmitting, setIsSubmitting] = useState(false);
        const [scanProgress, setScanProgress] = useState(0);
        const [aiStatus, setAiStatus] = useState("");
        
        const [formData, setFormData] = useState({
            firstName: '', middleName: '', lastName: '', dob: '', address: '', phone: '', email: '', 
            ssn: '', raceEthnicity: '', isHispanic: '', gender: '', language: '',
            guardianName: '', guardianPhone: '',
            lastGrade: '', attendedCollege: '', disabilityExplain: '', hasDisability: '',
            schoolStatusArrest: '', employStatusArrest: '', probationReleaseDate: '',
            pregnant: '', children: '', childrenLocation: '', arrested: '', arrestOutcome: '', probation: '', 
            registeredVoter: '', needVoterHelp: '', receiveSSI: '', receiveTANF: '', receiveSNAP: '',
            inSchool: '', schoolName: '', graduated: '', gradYear: '',
            takenConstClass: '', constExperience: '', constInterest: '', otherTrades: '', hobbies: '',
            emergencyName1: '', emergencyPhone1: '', emergencyName2: '', emergencyPhone2: '',
            job1Employer: '', job1Dates: '', job1Reason: '', job1Supervisor: '',
            job2Employer: '', job2Dates: '', job2Reason: '', job2Supervisor: '',
            job3Employer: '', job3Dates: '', job3Reason: '', job3Supervisor: '',
            ref1Name: '', ref1Rel: '', ref1Phone: '',
            ref2Name: '', ref2Rel: '', ref2Phone: '',
            ref3Name: '', ref3Rel: '', ref3Phone: '',
            programGoals: '', shirtSize: '', shoeSize: '', beltSize: '',
            workforcePermit: false, forkliftPermit: false, liabilityWaiver: false, roi: false, mediaRelease: '',
            applicantSignature: '', guardianSignature: '', signDate: new Date().toISOString().split('T')[0],
            idFile: null
        });

        const handleChange = (e) => {
            const { name, value, type, checked, files } = e.target;
            if (type === 'file') {
                setFormData(prev => ({ ...prev, [name]: files[0] }));
            } else {
                setFormData(prev => ({ ...prev, [name]: type === 'checkbox' ? checked : value }));
            }
        };

        // --- LOGIC: ID SCANNING (EXISTING) ---
        const handleScanID = async (e) => {
            const file = e.target.files[0];
            if (!file) return;
            
            setStatus("Scanning ID... Please wait.");
            setScanProgress(10);
            setFormData(prev => ({ ...prev, idFile: file }));

            try {
                const result = await Tesseract.recognize(file, 'eng', {
                    logger: m => { if(m.status === 'recognizing text') setScanProgress(parseInt(m.progress * 100)); }
                });
                
                const text = result.data.text;
                const nameMatch = text.match(/(?:Name|LN|FN)[:\s]+([A-Z][a-z]+(?:\s[A-Z][a-z]+)+)/i);
                const dobMatch = text.match(/(?:DOB|Date of Birth|Birth)[:\s]+(\d{1,2}[\/\-]\d{1,2}[\/\-]\d{2,4})/i);
                const addressMatch = text.match(/(\d+\s+[A-Za-z\s]+(?:Street|St|Avenue|Ave|Road|Rd|Boulevard|Blvd)[^\n]*)/i);

                setFormData(prev => ({
                    ...prev,
                    firstName: nameMatch ? nameMatch[1].split(' ')[0] : prev.firstName,
                    lastName: nameMatch ? nameMatch[1].split(' ').pop() : prev.lastName,
                    dob: dobMatch ? new Date(dobMatch[1]).toISOString().split('T')[0] : prev.dob,
                    address: addressMatch ? addressMatch[1] : prev.address
                }));
                
                setStatus("ID Scanned! Please verify.");
                setTimeout(() => setStatus(""), 3000);
            } catch (err) {
                setStatus("Could not read ID text. Please fill manually.");
            }
        };

        // --- LOGIC: PDF & SUBMIT (EXISTING) ---
        const generatePDF = () => {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            doc.setFillColor(22, 163, 74); 
            doc.rect(0, 0, 210, 40, 'F');
            doc.setTextColor(255, 255, 255);
            doc.setFontSize(22);
            doc.text('Project BUILD Application', 105, 25, { align: 'center' });
            doc.setTextColor(0, 0, 0);
            doc.setFontSize(10);
            let y = 50;
            const addLine = (label, val) => {
                if (y > 280) { doc.addPage(); y = 20; }
                doc.setFont(undefined, 'bold');
                doc.text(label, 20, y);
                doc.setFont(undefined, 'normal');
                doc.text(String(val || ''), 70, y);
                y += 8;
            };
            doc.setFontSize(14); doc.text("Personal Info", 20, y); y += 10; doc.setFontSize(10);
            addLine("Name:", `${formData.firstName} ${formData.middleName} ${formData.lastName}`);
            addLine("DOB:", formData.dob);
            addLine("Phone:", formData.phone);
            addLine("Email:", formData.email);
            addLine("Address:", formData.address);
            addLine("SSN:", formData.ssn);
            y += 5;
            doc.setFontSize(14); doc.text("Legal & History", 20, y); y += 10; doc.setFontSize(10);
            addLine("Arrested:", formData.arrested);
            addLine("Probation:", formData.probation);
            addLine("Financial Aid:", `SSI: ${formData.receiveSSI}, SNAP: ${formData.receiveSNAP}`);
            y += 5;
            doc.setFontSize(14); doc.text("Agreements", 20, y); y += 10; doc.setFontSize(10);
            addLine("Workforce Permission:", "Yes");
            addLine("Liability Waiver:", "Yes");
            addLine("Media Release:", formData.mediaRelease);
            addLine("Signature:", formData.applicantSignature);
            addLine("Date:", formData.signDate);
            return doc.output('blob');
        };

        const uploadToDropbox = async (fileBlob, fileName) => {
            const dbx = new Dropbox.Dropbox({ accessToken: CONFIG.dropbox.accessToken });
            try {
                const uploadResponse = await dbx.filesUpload({ path: `/${fileName}`, contents: fileBlob, mode: 'add', autorename: true });
                const linkResponse = await dbx.sharingCreateSharedLinkWithSettings({ path: uploadResponse.result.path_display });
                return linkResponse.result.url.replace('?dl=0', '?dl=1'); 
            } catch (error) {
                if (error.error?.error_summary?.includes('shared_link_already_exists')) { console.warn("Link exists"); }
                console.error("Dropbox Error", error);
                return null;
            }
        };

        const handleFinalSubmit = async () => {
            if (!formData.firstName || !formData.phone) { alert("Name and Phone are required."); return; }
            if (!isUnder18 && !formData.idFile) { alert("ID upload is required for adult applicants."); return; }
            setIsSubmitting(true);
            setStatus("Generating Application PDF...");
            try {
                const pdfBlob = generatePDF();
                const pdfName = `App_${formData.lastName}_${Date.now()}.pdf`;
                let pdfLink = "", idLink = "";
                setStatus("Uploading PDF to Cloud...");
                const link = await uploadToDropbox(pdfBlob, pdfName);
                if (link) pdfLink = link;
                if (formData.idFile) {
                    setStatus("Uploading ID Image...");
                    const idName = `ID_${formData.lastName}_${Date.now()}_${formData.idFile.name}`;
                    const idUrl = await uploadToDropbox(formData.idFile, idName);
                    if (idUrl) idLink = idUrl;
                }
                setStatus("Sending Email to Support...");
                const templateParams = {
                    to_email: 'info@projectbuildswfl.org',
                    from_name: `${formData.firstName} ${formData.lastName}`,
                    message: `New Application Received.\n\nApplicant: ${formData.firstName} ${formData.lastName}\nPhone: ${formData.phone}\n\nApplication PDF: ${pdfLink}\nID Document: ${idLink}`,
                    pdf_attachment: pdfLink
                };
                await emailjs.send(CONFIG.emailjs.serviceId, CONFIG.emailjs.templateId, templateParams);
                setStatus("✅ Application Submitted Successfully!");
                alert("Application Submitted! We will contact you soon.");
                setStep(0); 
            } catch (err) {
                console.error(err);
                setStatus("❌ Error: " + err.message);
                alert("Error submitting: " + err.message);
            } finally { setIsSubmitting(false); }
        };

        // --- STEP 0: START ---
        if (step === 0) {
            return (
                <div className="glass-panel-hero max-w-2xl mx-auto text-center p-0 fade-in">
                    <div className="header-green-glass rounded-t-2xl">
                        <h2 className="text-lg font-bold tracking-widest uppercase opacity-90 text-green-100 md:text-xl">Project BUILD</h2>
                        <h1 className="text-3xl font-black mt-2 text-white md:text-4xl">Workforce App</h1>
                    </div>
                    <div className="p-8 md:p-12">
                        <div className="mb-8 md:mb-10">
                            <img src="https://res.cloudinary.com/dwzg1q4kb/image/upload/IMG_0002_iduomk.png" alt="Project Build Logo" className="h-24 w-auto mx-auto mb-4 drop-shadow-md screen-logo md:h-32 md:mb-6" onError={(e) => {e.target.style.display='none'}} />
                            <h3 className="text-xs font-bold tracking-wide uppercase text-slate-500 md:text-sm">Building and Uplifting Individuals</h3>
                        </div>
                        <p className="text-slate-600 mb-8 text-lg font-medium md:mb-10 md:text-xl">Select your applicant type to begin.</p>
                        <div className="space-y-4 md:space-y-6">
                            <button onClick={() => { setIsUnder18(true); setStep(1); }} className="w-full p-6 rounded-xl bg-white border border-slate-200 hover:border-green-500 hover:shadow-xl transition-all font-bold text-slate-700 text-left flex items-center gap-4 group transform hover:-translate-y-1 md:p-8 md:rounded-2xl md:gap-6">
                                <div className="bg-green-100 p-3 rounded-full group-hover:bg-green-600 group-hover:text-white transition-colors md:p-4"><Icons.User className="w-6 h-6 md:w-8 md:h-8" /></div>
                                <div><div className="text-xl text-slate-800 font-black mb-1 md:text-2xl">I am Under 18</div><div className="text-xs text-slate-400 font-normal md:text-sm">Requires Guardian Consent</div></div>
                            </button>
                            <button onClick={() => { setIsUnder18(false); setStep(1); }} className="w-full p-6 rounded-xl bg-white border border-slate-200 hover:border-green-500 hover:shadow-xl transition-all font-bold text-slate-700 text-left flex items-center gap-4 group transform hover:-translate-y-1 md:p-8 md:rounded-2xl md:gap-6">
                                <div className="bg-slate-100 p-3 rounded-full group-hover:bg-slate-600 group-hover:text-white transition-colors md:p-4"><Icons.Check className="w-6 h-6 md:w-8 md:h-8" /></div>
                                <div className="text-xl text-slate-800 font-black md:text-2xl">I am 18 or Older</div>
                            </button>
                        </div>
                    </div>
                </div>
            );
        }

        // --- STEP 1: THE FORM ---
        return (
            <div className="glass-panel pb-20 w-full p-0">
                <div className="header-green-glass sticky top-0 z-50 flex justify-between items-center shadow-lg backdrop-blur-md">
                    <div className="flex items-center gap-3 md:gap-4">
                        <div className="bg-white/20 p-2 rounded-xl backdrop-blur-sm md:p-3"><Icons.HardHat className="w-6 h-6 text-white md:w-8 md:h-8" /></div>
                        <div><h1 className="text-lg font-black text-white tracking-tight leading-none md:text-2xl">PROJECT BUILD</h1><p className="text-green-100 text-xs font-medium uppercase tracking-wider mt-1 md:text-sm">Workforce Application</p></div>
                    </div>
                    <div className="text-xs font-bold bg-black/20 text-white px-3 py-1 rounded-full border border-white/20 tracking-wider md:text-sm md:px-4 md:py-2">{isUnder18 ? "UNDER 18" : "ADULT"}</div>
                </div>

                <div className="max-w-5xl mx-auto mt-8 px-4 fade-in pb-12 md:mt-12 md:px-8 md:pb-16">
                    
                    <SectionHeader title="1. Personal Information" icon={Icons.User} />
                    <div className="grid md:grid-cols-3 gap-4 mb-4 md:gap-6 md:mb-6">
                        <InputGroup id="firstName" label="First Name" name="firstName" value={formData.firstName} onChange={handleChange} required />
                        <InputGroup label="Middle" name="middleName" value={formData.middleName} onChange={handleChange} />
                        <InputGroup label="Last Name" name="lastName" value={formData.lastName} onChange={handleChange} required />
                    </div>
                    <div className="grid md:grid-cols-3 gap-4 mb-4 md:gap-6 md:mb-6">
                        <InputGroup id="dob" label="Date of Birth" name="dob" type="date" value={formData.dob} onChange={handleChange} required />
                        <InputGroup label="Phone Number" name="phone" type="tel" value={formData.phone} onChange={handleChange} required />
                        <InputGroup label="Email Address" name="email" type="email" value={formData.email} onChange={handleChange} />
                    </div>
                    <InputGroup id="address" label="Full Address" name="address" value={formData.address} onChange={handleChange} placeholder="Street, City, State, Zip Code" />
                    
                    <div className="grid md:grid-cols-4 gap-4 bg-white/60 border border-slate-200 p-4 rounded-xl mt-6 shadow-inner md:gap-6 md:p-6 md:rounded-2xl md:mt-8">
                        <InputGroup label="SSN" name="ssn" value={formData.ssn} onChange={handleChange} />
                        <InputGroup label="Race/Ethnicity" name="raceEthnicity" value={formData.raceEthnicity} onChange={handleChange} />
                        <InputGroup label="Hispanic/Latino?" name="isHispanic" value={formData.isHispanic} onChange={handleChange} options={['Yes', 'No']} />
                        <InputGroup label="Gender" name="gender" value={formData.gender} onChange={handleChange} options={['Male', 'Female', 'Non-Binary', 'Prefer Not to Say']} />
                        <InputGroup label="Primary Language" name="language" value={formData.language} onChange={handleChange} />
                    </div>

                    {isUnder18 && (
                        <div className="bg-amber-50/90 p-6 rounded-xl border-l-8 border-amber-400 my-8 shadow-md md:p-8 md:rounded-2xl md:my-10">
                            <h4 className="font-bold text-amber-900 mb-4 flex items-center gap-3 text-lg md:mb-6 md:text-xl"><Icons.User className="w-5 h-5 md:w-6 md:h-6"/> Guardian Information (Required)</h4>
                            <div className="grid md:grid-cols-2 gap-4 md:gap-6">
                                <InputGroup label="Guardian Name" name="guardianName" value={formData.guardianName} onChange={handleChange} required />
                                <InputGroup label="Guardian Phone" name="guardianPhone" value={formData.guardianPhone} onChange={handleChange} required />
                            </div>
                        </div>
                    )}

                    <SectionHeader title="2. History & Status" icon={Icons.Shield} />
                    <div className="grid md:grid-cols-2 gap-4 mb-4 md:gap-6 md:mb-6">
                        <InputGroup label="Currently in School?" name="inSchool" value={formData.inSchool} onChange={handleChange} options={['Yes', 'No']} />
                        <InputGroup label="School Name" name="schoolName" value={formData.schoolName} onChange={handleChange} />
                        <InputGroup label="Graduated/GED?" name="graduated" value={formData.graduated} onChange={handleChange} options={['Yes', 'No']} />
                        <InputGroup label="Grad Year" name="gradYear" value={formData.gradYear} onChange={handleChange} />
                        <InputGroup label="Last Grade Completed" name="lastGrade" value={formData.lastGrade} onChange={handleChange} />
                        <InputGroup label="Attended College?" name="attendedCollege" value={formData.attendedCollege} onChange={handleChange} options={['Yes', 'No']} />
                    </div>
                    <div className="bg-slate-50/80 p-4 rounded-xl border border-slate-200 my-6 md:p-6 md:rounded-2xl md:my-8">
                        <div className="grid md:grid-cols-2 gap-4 md:gap-6">
                            <InputGroup label="Pregnant?" name="pregnant" value={formData.pregnant} onChange={handleChange} options={['Yes', 'No', 'N/A']} />
                            <InputGroup label="Have Children?" name="children" value={formData.children} onChange={handleChange} options={['Yes', 'No']} />
                            {formData.children === 'Yes' && <InputGroup label="Children Location (Care/Relative)" name="childrenLocation" value={formData.childrenLocation} onChange={handleChange} width="full" />}
                        </div>
                    </div>
                    <div className="bg-red-50/80 p-6 rounded-xl border border-red-100 my-6 shadow-sm md:p-8 md:rounded-2xl md:my-8">
                        <h4 className="font-bold text-red-900 mb-4 text-base uppercase tracking-wide flex items-center gap-2 md:mb-6 md:text-lg"><Icons.Shield className="w-5 h-5"/> Legal History</h4>
                        <div className="grid md:grid-cols-2 gap-4 md:gap-6">
                            <InputGroup label="Ever Arrested?" name="arrested" value={formData.arrested} onChange={handleChange} options={['Yes', 'No']} />
                            {formData.arrested === 'Yes' && (
                                <>
                                    <InputGroup label="Outcome (Probation/etc)" name="arrestOutcome" value={formData.arrestOutcome} onChange={handleChange} />
                                    <InputGroup label="School Status at Arrest" name="schoolStatusArrest" value={formData.schoolStatusArrest} onChange={handleChange} />
                                    <InputGroup label="Employ. Status at Arrest" name="employStatusArrest" value={formData.employStatusArrest} onChange={handleChange} />
                                </>
                            )}
                            <InputGroup label="Currently on Probation?" name="probation" value={formData.probation} onChange={handleChange} options={['Yes', 'No']} />
                            {formData.probation === 'Yes' && <InputGroup label="Probation Release Date" name="probationReleaseDate" value={formData.probationReleaseDate} onChange={handleChange} type="date" />}
                        </div>
                    </div>
                    <div className="bg-white/60 p-6 rounded-xl mt-6 border border-slate-200 shadow-sm md:p-8 md:rounded-2xl md:mt-8">
                        <h4 className="font-bold text-slate-800 mb-4 text-base md:mb-6 md:text-lg">Financial Assistance</h4>
                        <div className="grid md:grid-cols-3 gap-4 md:gap-6">
                            <InputGroup label="Voter Reg?" name="registeredVoter" value={formData.registeredVoter} onChange={handleChange} options={['Yes', 'No']} />
                            <InputGroup label="Need Vote Help?" name="needVoterHelp" value={formData.needVoterHelp} onChange={handleChange} options={['Yes', 'No']} />
                            <InputGroup label="Receive SSI/SSDI?" name="receiveSSI" value={formData.receiveSSI} onChange={handleChange} options={['Yes', 'No']} />
                            <InputGroup label="Receive SNAP?" name="receiveSNAP" value={formData.receiveSNAP} onChange={handleChange} options={['Yes', 'No']} />
                            <InputGroup label="Receive TANF?" name="receiveTANF" value={formData.receiveTANF} onChange={handleChange} options={['Yes', 'No']} />
                            <div className="col-span-3 grid md:grid-cols-2 gap-4 mt-4 pt-4 border-t border-slate-200 md:gap-6 md:mt-4 md:pt-6">
                                <InputGroup label="Disability?" name="hasDisability" value={formData.hasDisability} onChange={handleChange} options={['Yes', 'No']} />
                                {formData.hasDisability === 'Yes' && <InputGroup label="Explain Disability" name="disabilityExplain" value={formData.disabilityExplain} onChange={handleChange} />}
                            </div>
                        </div>
                    </div>

                    <SectionHeader title="3. Construction Background" icon={Icons.HardHat} />
                    <div className="grid md:grid-cols-2 gap-4 md:gap-6">
                        <InputGroup label="Taken Construction Classes?" name="takenConstClass" value={formData.takenConstClass} onChange={handleChange} options={['Yes', 'No']} />
                        <InputGroup label="Any Construction Experience?" name="constExperience" value={formData.constExperience} onChange={handleChange} options={['Yes', 'No']} />
                        <InputGroup label="Interest in Carpentry/Construction?" name="constInterest" value={formData.constInterest} onChange={handleChange} options={['Yes', 'No']} />
                    </div>
                    <div className="grid md:grid-cols-2 gap-4 mt-4 md:gap-6">
                        <InputGroup label="Other Trades of Interest" name="otherTrades" value={formData.otherTrades} onChange={handleChange} />
                        <InputGroup label="Hobbies" name="hobbies" value={formData.hobbies} onChange={handleChange} />
                    </div>

                    <SectionHeader title="4. Employment History" icon={Icons.File} />
                    <p className="text-xs text-slate-500 mb-4 font-medium md:text-sm md:mb-6">List previous jobs (Leave blank if none)</p>
                    {[1,2,3].map(n => (
                        <div key={n} className="bg-white/50 p-4 rounded-xl mb-4 border border-slate-200 hover:shadow-md transition-shadow md:p-6 md:mb-6">
                            <h5 className="text-xs font-bold text-slate-400 uppercase mb-3 tracking-wider md:text-sm md:mb-4">Job {n}</h5>
                            <div className="grid md:grid-cols-4 gap-3 md:gap-4">
                                <InputGroup label="Employer" name={`job${n}Employer`} value={formData[`job${n}Employer`]} onChange={handleChange} />
                                <InputGroup label="Dates" name={`job${n}Dates`} value={formData[`job${n}Dates`]} onChange={handleChange} />
                                <InputGroup label="Reason Left" name={`job${n}Reason`} value={formData[`job${n}Reason`]} onChange={handleChange} />
                                <InputGroup label="Supervisor" name={`job${n}Supervisor`} value={formData[`job${n}Supervisor`]} onChange={handleChange} />
                            </div>
                        </div>
                    ))}

                    <SectionHeader title="5. References" icon={Icons.User} />
                    <div className="grid md:grid-cols-3 gap-4 md:gap-6">
                        {[1,2,3].map(n => (
                            <div key={n} className="bg-white/50 p-4 rounded-xl border border-slate-200 hover:shadow-md transition-shadow md:p-6">
                                <h5 className="text-xs font-bold text-slate-400 uppercase mb-3 tracking-wider md:text-sm md:mb-4">Reference {n}</h5>
                                <InputGroup label="Name" name={`ref${n}Name`} value={formData[`ref${n}Name`]} onChange={handleChange} />
                                <InputGroup label="Relationship" name={`ref${n}Rel`} value={formData[`ref${n}Rel`]} onChange={handleChange} />
                                <InputGroup label="Phone" name={`ref${n}Phone`} value={formData[`ref${n}Phone`]} onChange={handleChange} />
                            </div>
                        ))}
                    </div>

                    <SectionHeader title="6. Gear & Goals" icon={Icons.HardHat} />
                    <div className="grid md:grid-cols-3 gap-4 md:gap-6">
                        <InputGroup label="Shirt Size" name="shirtSize" value={formData.shirtSize} onChange={handleChange} />
                        <InputGroup label="Shoe Size" name="shoeSize" value={formData.shoeSize} onChange={handleChange} />
                        <InputGroup label="Belt Size" name="beltSize" value={formData.beltSize} onChange={handleChange} />
                    </div>
                    <div className="mt-4 md:mt-6">
                        <label className="block text-sm font-bold text-slate-700 mb-2 md:text-base md:mb-3">What would you like to receive from this program?</label>
                        <textarea name="programGoals" value={formData.programGoals} onChange={handleChange} className="w-full p-3 border border-slate-300 rounded-xl bg-white/80 backdrop-blur-sm h-24 focus:ring-2 focus:ring-green-500 focus:border-green-500 outline-none shadow-sm transition-all text-base md:p-4 md:h-32 md:text-lg"></textarea>
                    </div>

                    <SectionHeader title="7. Emergency Contacts" icon={Icons.Shield} />
                    <div className="grid md:grid-cols-2 gap-4 md:gap-6">
                        <InputGroup label="Primary Name" name="emergencyName1" value={formData.emergencyName1} onChange={handleChange} required />
                        <InputGroup label="Primary Phone" name="emergencyPhone1" value={formData.emergencyPhone1} onChange={handleChange} required />
                        <InputGroup label="Secondary Name" name="emergencyName2" value={formData.emergencyName2} onChange={handleChange} placeholder="If none, enter 'None' or Case Worker" />
                        <InputGroup label="Secondary Phone" name="emergencyPhone2" value={formData.emergencyPhone2} onChange={handleChange} placeholder="If none, enter 'N/A'" />
                    </div>
                    <p className="text-xs text-slate-500 mt-2 italic">
                        * If you do not have an emergency contact, please enter "None" or provide the contact information for a case manager or social worker.
                    </p>

                    {/* ID SCANNER MOVED TO BOTTOM */}
                    <SectionHeader title={`8. Verification Uploads ${!isUnder18 ? '(Required)' : '(Optional)'}`} icon={Icons.Upload} />
                    <div className="bg-blue-50/80 p-6 rounded-xl border border-blue-200 shadow-sm text-center flex flex-col justify-center items-center hover:shadow-md transition-shadow h-full relative overflow-hidden md:p-8 md:rounded-2xl">
                        {!isUnder18 && !formData.idFile && <div className="absolute top-0 right-0 bg-red-500 text-white text-xs font-bold px-3 py-1 rounded-bl-xl">REQUIRED</div>}
                        <div className="bg-blue-100 p-3 rounded-full mb-3 text-blue-600 md:p-4 md:mb-4"><Icons.Camera className="w-6 h-6 md:w-8 md:h-8" /></div>
                        <h4 className="text-base text-blue-900 mb-2 font-bold md:text-lg">Scan Photo ID</h4>
                        <p className="text-xs text-blue-600/80 mb-4 px-2 md:text-sm md:mb-6 md:px-4">Use your camera to scan your ID for verification and auto-fill.</p>
                        <input type="file" accept="image/*" capture="environment" id="cameraInput" className="hidden" onChange={handleScanID} />
                        <button onClick={() => document.getElementById('cameraInput').click()} className="btn-liquid px-6 py-3 rounded-lg font-bold text-white mb-2 inline-flex items-center gap-2 w-full justify-center text-base shadow-lg md:px-8 md:py-4 md:rounded-xl md:mb-3 md:gap-3 md:text-lg">
                            Scan ID Card <Icons.Camera className="w-5 h-5"/>
                        </button>
                        {status && <div className="mt-3 text-sm font-bold text-blue-700 bg-blue-100 px-3 py-1 rounded-full inline-block animate-pulse">{status}</div>}
                        {scanProgress > 0 && scanProgress < 100 && <div className="w-full bg-gray-200 rounded-full h-2.5 mt-3 overflow-hidden md:h-3 md:mt-4"><div className="bg-blue-600 h-2.5 rounded-full transition-all duration-300 md:h-3" style={{width: `${scanProgress}%`}}></div></div>}
                    </div>

                    <SectionHeader title="9. Waivers & Permissions" icon={Icons.File} />
                    <div className="space-y-6 md:space-y-8">
                        <LegalCheckbox label="1. Workforce Permission" name="workforcePermit" checked={formData.workforcePermit} onChange={handleChange} legalText={LegalText.Workforce} />
                        <LegalCheckbox label="2. Forklift Program Permission" name="forkliftPermit" checked={formData.forkliftPermit} onChange={handleChange} legalText={LegalText.Forklift} />
                        <LegalCheckbox label="3. Liability Waiver" name="liabilityWaiver" checked={formData.liabilityWaiver} onChange={handleChange} legalText={LegalText.Liability} />
                        <LegalCheckbox label="4. CRN Release (ROI)" name="roi" checked={formData.roi} onChange={handleChange} legalText={LegalText.ROI} />
                        
                        <div className="mb-8 bg-white p-4 rounded-xl shadow-md border border-slate-100 md:mb-10 md:p-6 md:rounded-2xl">
                            <h4 className="font-bold text-green-800 mb-2 text-md md:mb-3 md:text-lg">5. Media Release</h4>
                            <div className="legal-scroll-box no-print">{LegalText.Media}</div>
                            <div className="flex flex-col gap-4 mt-4 md:flex-row md:gap-8 md:mt-6">
                                <label className="flex items-center gap-3 cursor-pointer p-3 bg-green-50 rounded-lg hover:bg-green-100 transition-colors flex-1 border border-green-200 md:justify-center"><input type="radio" name="mediaRelease" value="Yes" onChange={handleChange} className="accent-green-600 w-5 h-5 md:w-6 md:h-6" /> <span className="font-bold text-green-800">Yes, I consent</span></label>
                                <label className="flex items-center gap-3 cursor-pointer p-3 bg-red-50 rounded-lg hover:bg-red-100 transition-colors flex-1 border border-red-200 md:justify-center"><input type="radio" name="mediaRelease" value="No" onChange={handleChange} className="accent-green-600 w-5 h-5 md:w-6 md:h-6" /> <span className="font-bold text-red-800">No, I do not consent</span></label>
                            </div>
                        </div>
                        
                        <div className="bg-slate-800 text-white p-6 rounded-2xl shadow-2xl border border-slate-600 md:p-10 md:rounded-3xl">
                            <h4 className="font-bold text-white mb-3 uppercase tracking-widest text-lg flex items-center gap-2 md:mb-4 md:text-xl md:gap-3"><Icons.File className="w-5 h-5 md:w-6 md:h-6"/> Digital Signature</h4>
                            <p className="text-xs text-slate-400 mb-6 font-medium md:text-sm md:mb-8">By typing your name below, you certify that all information is true and agree to the terms above.</p>
                            <div className="grid md:grid-cols-2 gap-6 md:gap-8">
                                <div>
                                    <label className="block text-xs text-slate-400 mb-2 uppercase tracking-wider font-bold">Applicant Signature</label>
                                    <input type="text" name="applicantSignature" value={formData.applicantSignature} onChange={handleChange} className="w-full p-3 rounded-xl bg-slate-700 border border-slate-600 text-white placeholder-slate-500 focus:ring-2 focus:ring-green-500 outline-none text-base font-serif italic md:p-4 md:text-lg" placeholder="Type Full Name" required />
                                </div>
                                {isUnder18 && (
                                    <div>
                                        <label className="block text-xs text-slate-400 mb-2 uppercase tracking-wider font-bold">Guardian Signature</label>
                                        <input type="text" name="guardianSignature" value={formData.guardianSignature} onChange={handleChange} className="w-full p-3 rounded-xl bg-slate-700 border border-slate-600 text-white placeholder-slate-500 focus:ring-2 focus:ring-green-500 outline-none text-base font-serif italic md:p-4 md:text-lg" placeholder="Type Full Name" required />
                                    </div>
                                )}
                                <div>
                                    <label className="block text-xs text-slate-400 mb-2 uppercase tracking-wider font-bold">Date</label>
                                    <input type="date" name="signDate" value={formData.signDate} onChange={handleChange} className="w-full p-3 rounded-xl bg-slate-700 border border-slate-600 text-white focus:ring-2 focus:ring-green-500 outline-none text-base md:p-4 md:text-lg" required />
                                </div>
                            </div>
                        </div>
                    </div>

                    <div className="flex flex-col gap-4 justify-between mt-10 pt-6 border-t border-slate-200 pb-8 md:flex-row md:mt-16 md:pt-8 md:pb-12">
                        <button onClick={() => setStep(0)} className="px-6 py-3 text-slate-500 hover:bg-slate-100 rounded-xl transition-colors font-bold text-base md:px-8 md:py-4 md:text-lg" disabled={isSubmitting}>Back to Start</button>
                        
                        <button onClick={handleFinalSubmit} disabled={isSubmitting} className="btn-liquid px-8 py-4 rounded-2xl font-black shadow-2xl text-lg transform transition hover:-translate-y-2 disabled:opacity-50 disabled:cursor-not-allowed md:px-16 md:py-5 md:text-2xl">
                            {isSubmitting ? status || "Processing..." : "SUBMIT APPLICATION"}
                        </button>
                    </div>
                    {status && <div className="text-center mt-4 font-bold text-slate-700 animate-pulse bg-white/80 inline-block px-4 py-2 rounded-full mx-auto md:mt-6 md:px-6">{status}</div>}
                </div>
            </div>
        );
    };

    function mountApp() {
        const container = document.getElementById('project-build-root');
        if (container) {
            try { ReactDOM.createRoot(container).render(<App />); } 
            catch (err) { container.innerHTML = `<div style="color:red; padding:20px;">Error: ${err.message}</div>`; }
        } else { setTimeout(mountApp, 500); }
    }
    if (document.readyState === 'complete') mountApp(); else window.addEventListener('load', mountApp);
</script>