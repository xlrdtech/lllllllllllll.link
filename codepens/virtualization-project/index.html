<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arch/Sequoia Project Explorer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- GSAP and ScrollTrigger CDNs -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/ScrollTrigger.min.js"></script>
    <!-- Chosen Palette: Warm Stone -->
    <!-- Application Structure Plan: The application transforms the linear study guide into a thematic, single-page dashboard. A sticky navigation bar ("Home", "Key Concepts", "Architectures", "AI Performance", "Process & Risk", "Quiz Me", "Deep Dives") allows users to freely explore logical topics. This structure is chosen for usability, breaking down dense information into interactive, digestible sections (e.g., clickable concept cards, comparative charts, a step-by-step quiz) rather than a simple Q&A list. The user flow is non-linear, encouraging exploration based on interest (e.g., comparing architectures visually, then drilling into a specific concept, then testing knowledge). -->
    <!-- Visualization & Content Choices:
        - Report Info: Q10 (AI Performance Boost) -> Goal: Compare -> Viz: Bar Chart (Chart.js) -> Interaction: Hover Tooltip -> Justification: Clearly visualizes the 30-50% performance uplift.
        - Report Info: Essay Q1 (Architectures) -> Goal: Compare -> Viz: 3 Radar Charts (Chart.js) -> Interaction: Hover Tooltip -> Justification: Allows multi-dimensional comparison (Stability, Performance, etc.) side-by-side.
        - Report Info: Essay Q4 (Bootstrap Process) -> Goal: Organize (Process) -> Viz: HTML/Tailwind Flowchart -> Interaction: None (Static Viz) -> Justification: Simplifies the complex text into an easy-to-follow visual flow.
        - Report Info: Essay Q2 (Risk) -> Goal: Inform -> Viz: HTML Card Layout -> Interaction: None (Static Viz) -> Justification: Highlights the core risk and its multi-layer mitigation clearly.
        - Report Info: Quiz Questions -> Goal: Engage/Test -> Viz: Interactive Quiz Module (HTML/JS) -> Interaction: Click (Next/Prev, Reveal Answer) -> Justification: Transforms passive reading into an active learning experience.
        - Report Info: Essay Q3 & Q5 (Deep Dives) -> Goal: Inform (Detailed) -> Viz: HTML Accordion (<details>/<summary>) -> Interaction: Click (Expand/Collapse) -> Justification: Hides dense text to keep the UI clean, allowing user-initiated drill-down.
        - Library/Method: All visualizations use Chart.js (Canvas) or pure HTML/Tailwind, adhering to constraints.
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        /* Global Reset and Initial State for Carousel */
        body {
            margin: 0;
            overflow: hidden; /* Prevent scrolling until GSAP initializes */
        }
        main {
            /* This is the dashboard content, pulled up behind the carousel */
            margin-top: -100vh;
        }

        /* Carousel Specific Styles */
        #intro-carousel-trigger {
            width: 100%;
            height: 700vh; /* Creates the large scroll space for the animation */
        }
        .carousel {
            width: 100vw;
            height: 100vh;
            perspective: 300px;
            overflow: hidden;
            opacity: 0;
            position: relative;
            z-index: 20;
        }
        .card {
            position: absolute;
            left: 50%;
            top: 50%;
            width: 60%;
            height: 80%;
            max-width: 400px;
            max-height: 600px;
            border-radius: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.5rem;
            font-weight: bold;
            font-family: 'Inter', sans-serif;
            color: #fff;
            text-align: center;
            padding: 2rem;
            line-height: 1.4;
        }
        .arrow {
            position: fixed;
            bottom: 5vh;
            left: 50%;
            height: 8vh;
            transform: translateX(-50%);
            z-index: 30;
        }

        /* Existing CSS for Dashboard */
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 500px;
            margin-left: auto;
            margin-right: auto;
            height: 350px;
            max-height: 400px;
        }
        @media (max-width: 640px) {
            .chart-container {
                height: 300px;
                max-height: 350px;
            }
        }
        details > summary {
            cursor: pointer;
            list-style: none;
        }
        details > summary::-webkit-details-marker {
            display: none;
        }
        details[open] > summary .arrow {
            transform: rotate(90deg);
        }
    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        stone: tailwind.colors.stone,
                        amber: tailwind.colors.amber,
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                },
            },
        }
    </script>
</head>
<body class="bg-stone-50 text-stone-800 font-sans antialiased">

    <!-- Header & Navigation -->
    <header class="bg-white/80 backdrop-blur-md shadow-sm sticky top-0 z-50">
        <nav class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex-shrink-0">
                    <h1 class="text-xl font-bold text-stone-900">Arch/Sequoia Project Explorer</h1>
                </div>
                <div class="hidden md:block">
                    <div class="ml-10 flex items-baseline space-x-4">
                        <a href="#home" class="text-stone-600 hover:text-amber-600 px-3 py-2 rounded-md text-sm font-medium">Home</a>
                        <a href="#concepts" class="text-stone-600 hover:text-amber-600 px-3 py-2 rounded-md text-sm font-medium">Key Concepts</a>
                        <a href="#architectures" class="text-stone-600 hover:text-amber-600 px-3 py-2 rounded-md text-sm font-medium">Architectures</a>
                        <a href="#performance" class="text-stone-600 hover:text-amber-600 px-3 py-2 rounded-md text-sm font-medium">AI Performance</a>
                        <a href="#process" class="text-stone-600 hover:text-amber-600 px-3 py-2 rounded-md text-sm font-medium">Process & Risk</a>
                        <a href="#quiz" class="text-stone-600 hover:text-amber-600 px-3 py-2 rounded-md text-sm font-medium">Quiz Me</a>
                        <a href="#deepdives" class="text-stone-600 hover:text-amber-600 px-3 py-2 rounded-md text-sm font-medium">Deep Dives</a>
                    </div>
                </div>
                <div class="md:hidden">
                    <button type="button" id="mobile-menu-button" class="inline-flex items-center justify-center p-2 rounded-md text-stone-500 hover:text-amber-600 hover:bg-stone-100 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-amber-500">
                        <span class="sr-only">Open main menu</span>
                        <svg class="block h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                        </svg>
                        <svg class="hidden h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                        </svg>
                    </button>
                </div>
            </div>
            <!-- Mobile Menu -->
            <div class="md:hidden hidden" id="mobile-menu">
                <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3">
                    <a href="#home" class="text-stone-600 hover:text-amber-600 block px-3 py-2 rounded-md text-base font-medium">Home</a>
                    <a href="#concepts" class="text-stone-600 hover:text-amber-600 block px-3 py-2 rounded-md text-base font-medium">Key Concepts</a>
                    <a href="#architectures" class="text-stone-600 hover:text-amber-600 block px-3 py-2 rounded-md text-base font-medium">Architectures</a>
                    <a href="#performance" class="text-stone-600 hover:text-amber-600 block px-3 py-2 rounded-md text-base font-medium">AI Performance</a>
                    <a href="#process" class="text-stone-600 hover:text-amber-600 block px-3 py-2 rounded-md text-base font-medium">Process & Risk</a>
                    <a href="#quiz" class="text-stone-600 hover:text-amber-600 block px-3 py-2 rounded-md text-base font-medium">Quiz Me</a>
                    <a href="#deepdives" class="text-stone-600 hover:text-amber-600 block px-3 py-2 rounded-md text-base font-medium">Deep Dives</a>
                </div>
            </div>
        </nav>
    </header>

    <!-- INTRO CAROUSEL - SCROLL TRIGGER -->
    <div id="intro-carousel-trigger">
        <div class="carousel">
            <div class="card">Arch Host Stability</div>
            <div class="card">QEMU/KVM Virtualization</div>
            <div class="card">GPU Passthrough (VFIO)</div>
            <div class="card">20-50% AI Performance Uplift</div>
            <div class="card">Autonomous OS Bootstrap</div>
            <div class="card">Tailscale Funnel Access</div>
            <div class="card">Scroll to Begin Exploration</div>
        </div>
        <svg class="arrow" viewBox="0 0 2 10">
            <path stroke="#333" d="M0,0 0,0" />
        </svg>
    </div>

    <!-- Main Content (Dashboard Sections) -->
    <main class="container mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- The negative margin is now in the CSS style block above for 'main' -->

        <!-- Home Section -->
        <section id="home" class="py-12">
            <div class="text-center">
                <h2 class="text-3xl font-extrabold text-stone-900 sm:text-4xl">The Mac Pro 5,1 Virtualization Project</h2>
                <p class="mt-4 text-lg text-stone-600 max-w-2xl mx-auto">An exploration of migrating a Mac Pro 5,1 from an unstable macOS boot to a robust Arch Linux host running macOS Sequoia in a virtual machine.</p>
            </div>
            <div class="mt-10 bg-white shadow-xl rounded-lg overflow-hidden max-w-4xl mx-auto">
                <div class="p-6 sm:p-8">
                    <h3 class="text-2xl font-bold text-amber-600">The Core Problem & Solution</h3>
                    <p class="mt-4 text-stone-700">The primary issue with the original setup was the **unreliable booting of macOS Sequoia**. This instability stemmed from the necessary use of **OpenCore Legacy Patcher (OCLP)**, a bootloader required to run modern macOS on the older Mac Pro hardware. Boot failures were frequent, causing unacceptable downtime for client work.</p>
                    <p class="mt-4 text-stone-700">The solution was to install **Arch Linux as the stable, native host OS** on the bare metal. Arch Linux now manages all hardware and runs a **virtual machine (VM) of macOS Sequoia** using QEMU/KVM. This architecture completely eliminates the OCLP-related boot instability, providing a reliable and high-performance workstation.</p>
                </div>
            </div>
        </section>

        <!-- Key Concepts Section -->
        <section id="concepts" class="py-12 bg-stone-100 rounded-lg">
            <div class="text-center">
                <h2 class="text-3xl font-extrabold text-stone-900">Key Concepts & Technologies</h2>
                <p class="mt-4 text-lg text-stone-600 max-w-2xl mx-auto">This section breaks down the key technologies and acronyms used in the project. Click on any term to see its definition and role in the architecture.</p>
            </div>
            <div id="concepts-grid" class="mt-10 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Concepts will be injected here by JS -->
            </div>
            <!-- Modal for concept definition -->
            <div id="concept-modal" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4 hidden" aria-labelledby="modal-title" role="dialog" aria-modal="true">
                <div id="concept-modal-content" class="bg-white rounded-lg shadow-xl max-w-lg w-full p-6 relative">
                    <button id="close-modal-button" class="absolute top-4 right-4 text-stone-500 hover:text-stone-800">
                        <svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                    </button>
                    <h3 id="modal-title" class="text-2xl font-bold text-amber-600"></h3>
                    <p id="modal-definition" class="mt-4 text-stone-700"></p>
                </div>
            </div>
        </section>

        <!-- Architectures Section -->
        <section id="architectures" class="py-12">
            <div class="text-center">
                <h2 class="text-3xl font-extrabold text-stone-900">Architecture Comparison</h2>
                <p class="mt-4 text-lg text-stone-600 max-w-2xl mx-auto">This section visually compares the three main architectural approaches discussed for the Mac Pro 5,1, highlighting their trade-offs in stability, performance, and complexity.</p>
            </div>
            <div class="mt-10 grid grid-cols-1 lg:grid-cols-3 gap-8">
                <!-- Arch 1: Native Dual-Boot -->
                <div class="bg-white shadow-xl rounded-lg p-6 flex flex-col">
                    <h3 class="text-2xl font-bold text-stone-900 text-center">Native Dual-Boot</h3>
                    <div class="chart-container h-80 sm:h-96">
                        <canvas id="arch-chart-1"></canvas>
                    </div>
                    <div class="mt-4 flex-grow">
                        <p class="text-stone-700"><strong class="text-amber-600">Pros:</strong> Highest potential native performance for both OSes, as each has direct hardware access.</p>
                        <p class="mt-2 text-stone-700"><strong class="text-red-600">Cons:</strong> Extreme boot instability for macOS due to reliance on the unreliable OpenCore Legacy Patcher (OCLP), leading to unacceptable downtime.</p>
                    </div>
                </div>
                <!-- Arch 2: Arch Host + Sequoia VM -->
                <div class="bg-white shadow-xl rounded-lg p-6 flex flex-col border-4 border-amber-500">
                    <div class="text-center">
                        <span class="inline-flex items-center rounded-full bg-amber-100 px-3 py-0.5 text-sm font-medium text-amber-800">Recommended</span>
                        <h3 class="text-2xl font-bold text-stone-900 mt-2">Arch Host + Sequoia VM</h3>
                    </div>
                    <div class="chart-container h-80 sm:h-96">
                        <canvas id="arch-chart-2"></canvas>
                    </div>
                    <div class="mt-4 flex-grow">
                        <p class="text-stone-700"><strong class="text-amber-600">Pros:</strong> Prioritizes stability. Achieves near-native macOS performance via QEMU/KVM and GPU Passthrough. Provides a highly efficient Linux base for containerized AI development (ROCm/Ollama).</p>
                        <p class="mt-2 text-stone-700"><strong class="text-red-600">Cons:</strong> Slight virtualization overhead and higher initial setup complexity.</p>
                    </div>
                </div>
                <!-- Arch 3: Nitro 5 Hosted VM -->
                <div class="bg-white shadow-xl rounded-lg p-6 flex flex-col">
                    <h3 class="text-2xl font-bold text-stone-900 text-center">Nitro 5 Hosted VM</h3>
                    <div class="chart-container h-80 sm:h-96">
                        <canvas id="arch-chart-3"></canvas>
                    </div>
                    <div class="mt-4 flex-grow">
                        <p class="text-stone-700"><strong class="text-amber-600">Pros:</strong> Good disaster recovery option. Separates compute load from the main workstation.</p>
                        <p class="mt-2 text-stone-700"><strong class="text-red-600">Cons:</strong> Requires a second powerful machine. Introduces potential network latency for GUI access, making it unsuitable as a main workstation replacement.</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- AI Performance Section -->
        <section id="performance" class="py-12 bg-stone-100 rounded-lg">
            <div class="text-center">
                <h2 class="text-3xl font-extrabold text-stone-900">Local AI Performance Upgrade</h2>
                <p class="mt-4 text-lg text-stone-600 max-w-2xl mx-auto">Running AI tools like Ollama on the Arch Linux host provides a significant performance upgrade compared to running them natively on macOS, thanks to direct GPU acceleration with ROCm.</p>
            </div>
            <div class="mt-10 bg-white shadow-xl rounded-lg p-6 max-w-4xl mx-auto">
                <h3 class="text-2xl font-bold text-stone-900 text-center">AI Inference Speed (Tokens/sec)</h3>
                <div class="chart-container h-80 sm:h-96 max-w-2xl">
                    <canvas id="performance-chart"></canvas>
                </div>
                <p class="mt-4 text-stone-700 text-center max-w-2xl mx-auto">The Arch host, leveraging AMD's ROCm stack for the RX 580 GPU, is **30-50% faster** for AI inference than using the Metal framework on macOS. This results in a **20-50% uplift** in token generation speed, faster model loading, and better overall resource utilization for AI workflows.</p>
            </div>
        </section>

        <!-- Process & Risk Section -->
        <section id="process" class="py-12">
            <div class="text-center">
                <h2 class="text-3xl font-extrabold text-stone-900">Process & Risk Management</h2>
                <p class="mt-4 text-lg text-stone-600 max-w-2xl mx-auto">This section outlines the project's risk mitigation strategy and the "Autonomous OS Bootstrap" process for zero-touch deployment.</p>
            </div>
            <div class="mt-10 grid grid-cols-1 lg:grid-cols-2 gap-8">
                <!-- Risk Analysis -->
                <div class="bg-white shadow-xl rounded-lg p-6">
                    <h3 class="text-2xl font-bold text-stone-900 text-center">Risk Analysis & Mitigation</h3>
                    <p class="mt-4 text-stone-700 text-center">The project's final risk rating is **MINIMAL** due to a multi-layered mitigation strategy.</p>
                    <div class="mt-6">
                        <div class="bg-red-100 border-l-4 border-red-500 p-4 rounded-r-lg">
                            <h4 class="text-lg font-bold text-red-900">Catastrophic Risk: Data Loss</h4>
                            <p class="text-red-800">Total loss or corruption of client data on the existing macOS Sequoia SSD.</p>
                        </div>
                        <div class="text-5xl text-center text-stone-400 my-4">↓</div>
                        <div class="space-y-4">
                            <div class="bg-green-100 border-l-4 border-green-500 p-4 rounded-r-lg">
                                <h4 class="text-lg font-bold text-green-900">Mitigation 1: Disk Clone</h4>
                                <p class="text-green-800">A full disk clone of the Sequoia drive was created *before* the project, ensuring an immediate, safe rollback point.</p>
                            </div>
                            <div class="bg-green-100 border-l-4 border-green-500 p-4 rounded-r-lg">
                                <h4 class="text-lg font-bold text-green-900">Mitigation 2: Raw Disk Passthrough</h4>
                                <p class="text-green-800">The VM accesses the original drive as a raw disk, which is never mounted or modified by the Arch host, protecting its integrity.</p>
                            </div>
                            <div class="bg-green-100 border-l-4 border-green-500 p-4 rounded-r-lg">
                                <h4 class="text-lg font-bold text-green-900">Mitigation 3: OCLP Elimination</h4>
                                <p class="text-green-800">Removing the unstable OCLP boot process eliminates the primary source of software-level corruption risk.</p>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Autonomous Bootstrap -->
                <div class="bg-white shadow-xl rounded-lg p-6">
                    <h3 class="text-2xl font-bold text-stone-900 text-center">Autonomous OS Bootstrap Flow</h3>
                    <p class="mt-4 text-stone-700 text-center">A zero-touch, self-replicating deployment process orchestrated by the "Autonomous Agent Empire."</p>
                    <div class="mt-6 space-y-4">
                        <div class="bg-stone-100 p-4 rounded-lg shadow-sm text-center">
                            <h4 class="font-bold text-stone-800">1. Kasm Workspaces</h4>
                            <p class="text-sm text-stone-600">Streams the VM's desktop via web browser.</p>
                        </div>
                        <div class="text-2xl text-center text-amber-600">→</div>
                        <div class="bg-stone-100 p-4 rounded-lg shadow-sm text-center">
                            <h4 class="font-bold text-stone-800">2. Tailscale Funnel</h4>
                            <p class="text-sm text-stone-600">Securely exposes the Kasm web interface to the public internet.</p>
                        </div>
                        <div class="text-2xl text-center text-amber-600">→</div>
                        <div class="bg-stone-100 p-4 rounded-lg shadow-sm text-center">
                            <h4 class="font-bold text-stone-800">3. Autonomous Agent</h4>
                            <p class="text-sm text-stone-600">Accesses the remote desktop to perform automation.</p>
                        </div>
                        <div class="text-2xl text-center text-amber-600">→</div>
                        <div class="bg-stone-100 p-4 rounded-lg shadow-sm text-center">
                            <h4 class="font-bold text-stone-800">4. Vision-Based Automation</h4>
                            <p class="text-sm text-stone-600">Uses OCR/OpenCV to "see" and interact with the GUI (clicks, typing).</p>
                        </div>
                        <div class="text-2xl text-center text-amber-600">→</div>
                        <div class="bg-stone-100 p-4 rounded-lg shadow-sm text-center">
                            <h4 class="font-bold text-stone-800">5. Docker MCP Gateway</h4>
                            <p class="text-sm text-stone-600">Coordinates AI tools (e.g., Playwright) on the Arch host to execute the workflow.</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Quiz Me Section -->
        <section id="quiz" class="py-12 bg-stone-100 rounded-lg">
            <div class="text-center">
                <h2 class="text-3xl font-extrabold text-stone-900">Test Your Knowledge</h2>
                <p class="mt-4 text-lg text-stone-600 max-w-2xl mx-auto">Review the key facts from the project with this interactive quiz. Click "Reveal Answer" to check your understanding.</p>
            </div>
            <div class="mt-10 max-w-2xl mx-auto bg-white shadow-xl rounded-lg p-6 sm:p-8">
                <div class="min-h-[200px]">
                    <p class="text-sm font-medium text-amber-600" id="question-number"></p>
                    <h3 class="mt-2 text-2xl font-bold text-stone-900" id="question-text"></h3>
                    <div id="answer-container" class="hidden mt-4">
                        <p class="text-stone-700" id="answer-text"></p>
                    </div>
                </div>
                <div class="mt-6 flex flex-col sm:flex-row sm:items-center sm:justify-between">
                    <button id="reveal-answer-button" class="w-full sm:w-auto inline-flex justify-center items-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-amber-600 hover:bg-amber-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-amber-500">
                        Reveal Answer
                    </button>
                    <div class="mt-4 sm:mt-0 flex justify-between sm:justify-end sm:space-x-4">
                        <button id="prev-question-button" class="inline-flex items-center px-4 py-2 border border-stone-300 text-sm font-medium rounded-md text-stone-700 bg-white hover:bg-stone-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-amber-500">
                            Previous
                        </button>
                        <button id="next-question-button" class="inline-flex items-center px-4 py-2 border border-stone-300 text-sm font-medium rounded-md text-stone-700 bg-white hover:bg-stone-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-amber-500">
                            Next
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Deep Dives Section -->
        <section id="deepdives" class="py-12">
            <div class="text-center">
                <h2 class="text-3xl font-extrabold text-stone-900">Deep Dives</h2>
                <p class="mt-4 text-lg text-stone-600 max-w-2xl mx-auto">Explore detailed explanations of the project's complex troubleshooting and deployment models. Click any topic to expand.</p>
            </div>
            <div class="mt-10 max-w-3xl mx-auto space-y-4">
                <!-- Deep Dive 1: Troubleshooting -->
                <details class="bg-white shadow-lg rounded-lg overflow-hidden">
                    <summary class="p-6 flex justify-between items-center">
                        <h3 class="text-xl font-bold text-stone-900">Deep Dive: The VM Boot Troubleshooting Process</h3>
                        <span class="arrow text-amber-600 transition-transform duration-200 ease-in-out">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
                        </span>
                    </summary>
                    <div class="p-6 pt-0 border-t border-stone-200">
                        <p class="text-stone-700">The troubleshooting session to boot the existing Sequoia installation as a VM was long and complex. The logical progression was as follows:</p>
                        <ul class="mt-4 list-decimal list-inside space-y-2 text-stone-700">
                            <li>It began by attempting to boot the SSD using **raw QEMU commands**. This failed, consistently dropping the VM into the **OVMF UEFI shell** because it couldn't find a bootable image.</li>
                            <li>The configuration was then migrated to **libvirt XML** to provide a stable, managed environment, but the core boot failure persisted.</li>
                            <li>The final diagnosis was that the native macOS installation relied on Apple’s proprietary **APFS boot system**. Its EFI partition was critically **missing the standard `BOOTX64.EFI`** file that generic UEFI firmware (like QEMU's OVMF) expects to find.</li>
                            <li>The resolution was to introduce a working **OpenCore** bootloader (from the OSX-KVM project) into the VM's configuration. OpenCore's critical role was to act as an intermediary, translating the standard UEFI environment into the necessary context to recognize the APFS filesystem and successfully initiate the macOS boot process.</li>
                        </ul>
                    </div>
                </details>

                <!-- Deep Dive 2: Hybrid Deployment -->
                <details class="bg-white shadow-lg rounded-lg overflow-hidden">
                    <summary class="p-6 flex justify-between items-center">
                        <h3 class="text-xl font-bold text-stone-900">Deep Dive: Hybrid Deployment vs. Tailscale Funnel</h3>
                        <span class="arrow text-amber-600 transition-transform duration-200 ease-in-out">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
                        </span>
                    </summary>
                    <div class="p-6 pt-0 border-t border-stone-200">
                        <p class="text-stone-700">The initial **hybrid deployment model** involved running services like Kasm locally on the Arch host, but utilizing a **remote Spaceship.com proxy** (or similar VPS) to create the public-facing HTTPS endpoint. This required establishing and maintaining an **SSH tunnel** to securely forward the local Kasm traffic from the Mac Pro to the remote proxy. This model was complex, requiring management of an external server, proxy configuration, and persistent tunnel maintenance, while also introducing extra network latency.</p>
                        <p class="mt-4 text-stone-700">**Tailscale Funnel** is presented as a vastly superior alternative because it drastically simplifies the architecture. It **eliminates the need for the external proxy and SSH tunnel entirely**. It leverages the secure, zero-config Tailscale VPN network to expose the local Kasm service directly to the public internet through a secure, automatically provisioned **HTTPS endpoint**, providing robust public access with reduced latency and no dependency on complex external infrastructure.</p>
                    </div>
                </details>
            </div>
        </section>

    </main>

    <footer class="bg-stone-800 text-stone-300 py-8 mt-16">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8 text-center">
            <p class="text-sm">An interactive dashboard generated based on the Arch Linux & Sequoia VM Project Study Guide.</p>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {

            gsap.registerPlugin(ScrollTrigger);

            // New GSAP/Carousel Code
            const colors = ['255,90,80','125,250,225','225,150,225'];
            const tl = gsap.timeline({defaults:{duration:2}})
            .set('.card', {
              backgroundColor:(i)=>'rgba('+colors[gsap.utils.wrap(0, colors.length, i)]+',0.7)',
              backgroundImage:(i,t,a)=>(i==a.length-1)?'radial-gradient(ellipse at 330px 120px, rgba(0,0,0,0) 30%, #000 150%)':'radial-gradient(ellipse at 2500px -400px, rgba(0,0,0,0) 0%, #000 60%)',
              transformOrigin:'50% 999px -100px',
              backdropFilter: 'blur(20px)',
              x:'-50%',
              y:'-45%',
              z:-500,
              rotateX:2
            })
            .to('.card', {
              z:10,
              rotateX:-3,
              stagger:-1
            }, 0)
            .to('.card', {
              yPercent:100,
              stagger:-1,
              ease:'back.in(2)'
            }, 0)
            .to('.card', {
              duration:1,
              backdropFilter: 'blur(8px)',
              backgroundImage: 'radial-gradient(ellipse at 150px 250px, rgba(0,0,0,0) 80%, #000 300%)',
              stagger:-1,
              ease:'power3.in'
            }, 0)
            .to('.card', {
              duration:1,
              backdropFilter: 'blur(1px)',
              backgroundImage: 'radial-gradient(ellipse at -1000px 500px, rgba(0,0,0,0) 0%, #000 50%)',
              stagger:-1,
              ease:'sine.in'
            }, 1)
            .to('.card', {
              duration:0.1,
              autoAlpha:0,
              stagger:-1,
            }, 1.9)
            .pause(1)

            gsap.timeline()
            .to('.carousel', {duration:0.8, opacity:1, ease:'power2.inOut'})
            .fromTo(tl, {
              progress:1
            },{
              duration:1.5,
              progress:0.07,
              ease:'expo',
              onComplete:initST
            }, 0)

            function initST(){
              // Set overflow to auto (or scroll) to enable user scrolling
              gsap.set('body', {overflow:'auto'})

              gsap.to(tl, {
                progress:1,
                scrollTrigger:{
                  trigger:'#intro-carousel-trigger',
                  start:'0 0',
                  end:'100% 100%',
                  scrub:true,
                  pin:'.carousel'
                }
              })

              gsap.timeline({repeat:-1, repeatDelay:0.5})
              .to('.arrow path', { attr:{d:'M0,0 0,10'}, ease:'power3.inOut' })
              .to('.arrow path', { attr:{d:'M0,10 0,10'}, ease:'power3.inOut' })

              gsap.to('.arrow', {
                opacity:0,
                scrollTrigger:{
                  trigger:'#intro-carousel-trigger',
                  start:'0 0',
                  end:'9px 0',
                  scrub:1,
                }
              })
            }
            // End of New GSAP/Carousel Code

            // Mobile Menu Toggle
            const mobileMenuButton = document.getElementById('mobile-menu-button');
            const mobileMenu = document.getElementById('mobile-menu');
            const mobileMenuLinks = mobileMenu.querySelectorAll('a');

            mobileMenuButton.addEventListener('click', () => {
                const isHidden = mobileMenu.classList.contains('hidden');
                mobileMenu.classList.toggle('hidden');
                mobileMenuButton.querySelector('svg:first-child').classList.toggle('hidden', !isHidden);
                mobileMenuButton.querySelector('svg:last-child').classList.toggle('hidden', isHidden);
            });

            const closeMobileMenu = () => {
                mobileMenu.classList.add('hidden');
                mobileMenuButton.querySelector('svg:first-child').classList.remove('hidden');
                mobileMenuButton.querySelector('svg:last-child').classList.add('hidden');
            };

            mobileMenuLinks.forEach(link => {
                link.addEventListener('click', closeMobileMenu);
            });

            // Smooth Scroll for Nav Links
            document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                anchor.addEventListener('click', function (e) {
                    e.preventDefault();
                    const targetId = this.getAttribute('href');
                    const targetElement = document.querySelector(targetId);
                    if (targetElement) {
                        targetElement.scrollIntoView({
                            behavior: 'smooth'
                        });
                    }
                });
            });

            // Key Concepts Data
            const concepts = [
                {
                    term: "QEMU/KVM",
                    definition: "macOS Sequoia runs as a virtual machine (VM) inside the Arch Linux host. This is enabled by QEMU, a machine emulator, which is hardware-accelerated by KVM (Kernel-based Virtual Machine) to achieve near-native performance."
                },
                {
                    term: "OpenCore Legacy Patcher (OCLP)",
                    definition: "OCLP is a complex bootloader that injects patches to allow modern macOS versions to run on officially unsupported hardware. It was the source of the original system's boot instability."
                },
                {
                    term: "GPU Passthrough (VFIO)",
                    definition: "A virtualization method that gives a VM exclusive, direct control over a physical PCI device (the RX 580 graphics card). This is critical for achieving 98-99% of native graphics performance for video editing and AI."
                },
                {
                    term: "Kasm Workspaces",
                    definition: "A containerized application streaming platform that provides secure, remote access to the macOS Sequoia desktop from any device with a modern web browser."
                },
                {
                    term: "Tailscale Funnel",
                    definition: "A service that securely exposes local network services (like Kasm) to the public internet over a secure HTTPS connection, eliminating the need for complex firewall configurations or a static IP."
                },
                {
                    term: "Autonomous Agent Empire",
                    definition: "An open-source framework for developing self-replicating agents that automate complex workflows (like OS installs) using vision-based techniques (OCR, OpenCV) and voice control, bypassing the need for APIs."
                },
                {
                    term: "ROCm",
                    definition: "An open-source software stack from AMD for GPU computing. It is used on the Arch host to enable GPU acceleration for the Radeon RX 580, significantly speeding up AI workloads in tools like Ollama."
                },
                {
                    term: "libvirt",
                    definition: "A toolkit to manage platform virtualization. It provides a stable management layer for KVM/QEMU and was used during troubleshooting to define and control the VM with an XML configuration file."
                }
            ];

            // Populate Key Concepts
            const conceptsGrid = document.getElementById('concepts-grid');
            const modal = document.getElementById('concept-modal');
            const modalTitle = document.getElementById('modal-title');
            const modalDefinition = document.getElementById('modal-definition');
            const closeModalButton = document.getElementById('close-modal-button');
            const modalContent = document.getElementById('concept-modal-content');

            concepts.forEach(concept => {
                const card = document.createElement('button');
                card.className = 'bg-white shadow-lg rounded-lg p-6 text-left hover:shadow-xl hover:scale-[1.02] transition-all duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-amber-500 focus:ring-offset-2';
                card.innerHTML = `<h3 class="text-xl font-bold text-stone-900">${concept.term}</h3><p class="mt-2 text-sm text-stone-600 truncate">${concept.definition}</p><span class="mt-4 inline-block text-sm font-medium text-amber-600">Learn More &rarr;</span>`;
                card.addEventListener('click', () => {
                    modalTitle.textContent = concept.term;
                    modalDefinition.textContent = concept.definition;
                    modal.classList.remove('hidden');
                });
                conceptsGrid.appendChild(card);
            });

            const closeModal = () => {
                modal.classList.add('hidden');
            };

            closeModalButton.addEventListener('click', closeModal);
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    closeModal();
                }
            });


            // Quiz Data
            const quizData = [
                {
                    q: "What was the primary problem with the original Mac Pro 5,1 setup that prompted the migration project?",
                    a: "The main issue was the unreliable and time-consuming booting of macOS Sequoia due to the necessary use of OpenCore Legacy Patcher (OCLP), which frequently failed to boot and caused unacceptable downtime."
                },
                {
                    q: "What is the main role of Arch Linux in the proposed final architecture?",
                    a: "Arch Linux serves as the stable, native host operating system on the bare metal. It manages the hardware, runs containerized services, and hosts the macOS Sequoia virtual machine, eliminating boot reliability issues."
                },
                {
                    q: "What is the function of Kasm Workspaces within this technical stack?",
                    a: "Kasm Workspaces is a containerized application streaming platform used to provide secure, web-based remote access to the macOS Sequoia desktop from any device with a browser."
                },
                {
                    q: "Describe GPU Passthrough (VFIO). Why is it a recommended component for the macOS Sequoia virtual machine?",
                    a: "GPU Passthrough (VFIO) is a virtualization technique that allows a VM to have exclusive, direct control over a physical graphics card. It is recommended because it provides the Sequoia VM with 98-99% of native graphics performance."
                },
                {
                    q: "During the extensive troubleshooting session, what was the key issue that prevented the existing Sequoia SSD from booting as a QEMU virtual machine?",
                    a: "The key issue was that the existing installation's EFI partition was missing the standard BOOTX64.EFI file that QEMU/OVMF (a standard UEFI environment) looks for. The native installation relied on Apple's proprietary APFS boot system."
                },
                {
                    q: "Why is the Arch host with a Sequoia VM considered a significant performance upgrade for local AI development?",
                    a: "The Arch host is a lightweight environment that allows for direct GPU acceleration with ROCm on the AMD RX 580, which is 30-50% faster for AI inference than using Metal on macOS, resulting in significantly higher token generation speed."
                }
            ];

            // Quiz Logic
            let currentQuestionIndex = 0;
            const questionNumberEl = document.getElementById('question-number');
            const questionTextEl = document.getElementById('question-text');
            const answerContainerEl = document.getElementById('answer-container');
            const answerTextEl = document.getElementById('answer-text');
            const revealButton = document.getElementById('reveal-answer-button');
            const prevButton = document.getElementById('prev-question-button');
            const nextButton = document.getElementById('next-question-button');

            function showQuestion() {
                const currentQuestion = quizData[currentQuestionIndex];
                questionNumberEl.textContent = `Question ${currentQuestionIndex + 1} of ${quizData.length}`;
                questionTextEl.textContent = currentQuestion.q;
                answerTextEl.textContent = currentQuestion.a;
                answerContainerEl.classList.add('hidden');
                revealButton.textContent = 'Reveal Answer';

                prevButton.disabled = currentQuestionIndex === 0;
                nextButton.disabled = currentQuestionIndex === quizData.length - 1;
                prevButton.classList.toggle('opacity-50', prevButton.disabled);
                nextButton.classList.toggle('opacity-50', nextButton.disabled);
            }

            revealButton.addEventListener('click', () => {
                const isHidden = answerContainerEl.classList.contains('hidden');
                answerContainerEl.classList.toggle('hidden');
                revealButton.textContent = isHidden ? 'Hide Answer' : 'Reveal Answer';
            });

            prevButton.addEventListener('click', () => {
                if (currentQuestionIndex > 0) {
                    currentQuestionIndex--;
                    showQuestion();
                }
            });

            nextButton.addEventListener('click', () => {
                if (currentQuestionIndex < quizData.length - 1) {
                    currentQuestionIndex++;
                    showQuestion();
                }
            });

            showQuestion();

            // Chart.js Implementations
            const defaultChartOptions = {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        labels: {
                            color: '#44403c'
                        }
                    }
                },
                scales: {
                    r: {
                        angleLines: { color: '#d6d3d1' },
                        grid: { color: '#e7e5e4' },
                        pointLabels: {
                            color: '#44403c',
                            font: {
                                size: 13,
                                weight: 'bold'
                            }
                        },
                        ticks: {
                            color: '#57534e',
                            backdropColor: '#f5f5f4'
                        }
                    },
                    x: {
                        grid: { display: false },
                        ticks: { color: '#44403c', font: { weight: 'bold' } }
                    },
                    y: {
                        grid: { color: '#e7e5e4' },
                        ticks: { color: '#44403c' }
                    }
                }
            };

            // Architecture Radar Charts
            const archLabels = ['Stability', 'Native Perf.', 'AI Perf.', 'Simplicity'];
            new Chart(document.getElementById('arch-chart-1'), {
                type: 'radar',
                data: {
                    labels: archLabels,
                    datasets: [{
                        label: 'Native Dual-Boot',
                        data: [2, 10, 7, 6],
                        backgroundColor: 'rgba(239, 68, 68, 0.2)',
                        borderColor: 'rgba(239, 68, 68, 1)',
                        borderWidth: 2,
                        pointBackgroundColor: 'rgba(239, 68, 68, 1)'
                    }]
                },
                options: { ...defaultChartOptions, plugins: { legend: { display: false } } }
            });

            new Chart(document.getElementById('arch-chart-2'), {
                type: 'radar',
                data: {
                    labels: archLabels,
                    datasets: [{
                        label: 'Arch Host + VM',
                        data: [9, 9, 10, 4],
                        backgroundColor: 'rgba(217, 119, 6, 0.2)',
                        borderColor: 'rgba(217, 119, 6, 1)',
                        borderWidth: 2,
                        pointBackgroundColor: 'rgba(217, 119, 6, 1)'
                    }]
                },
                options: { ...defaultChartOptions, plugins: { legend: { display: false } } }
            });

            new Chart(document.getElementById('arch-chart-3'), {
                type: 'radar',
                data: {
                    labels: archLabels,
                    datasets: [{
                        label: 'Nitro 5 Hosted VM',
                        data: [8, 7, 7, 7],
                        backgroundColor: 'rgba(107, 114, 128, 0.2)',
                        borderColor: 'rgba(107, 114, 128, 1)',
                        borderWidth: 2,
                        pointBackgroundColor: 'rgba(107, 114, 128, 1)'
                    }]
                },
                options: { ...defaultChartOptions, plugins: { legend: { display: false } } }
            });

            // AI Performance Bar Chart
            new Chart(document.getElementById('performance-chart'), {
                type: 'bar',
                data: {
                    labels: ['macOS (Metal)', 'Arch Host (ROCm)'],
                    datasets: [{
                        label: 'Relative Inference Speed',
                        data: [100, 140],
                        backgroundColor: [
                            'rgba(107, 114, 128, 0.6)',
                            'rgba(217, 119, 6, 0.6)'
                        ],
                        borderColor: [
                            'rgba(107, 114, 128, 1)',
                            'rgba(217, 119, 6, 1)'
                        ],
                        borderWidth: 2
                    }]
                },
                options: {
                    ...defaultChartOptions,
                    scales: { y: { beginAtZero: true, grid: { color: '#e7e5e4' }, ticks: { color: '#44403c' } }, x: { grid: { display: false }, ticks: { color: '#44403c', font: { size: 14, weight: 'bold' } } } },
                    plugins: { legend: { display: false } }
                }
            });

        });
    </script>
</body>
</html>